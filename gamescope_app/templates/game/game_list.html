{% extends "base.html" %}

{% block title %}All Games{% endblock title %}

{% block content %}
<h1>All Games</h1>

<!-- Search & Filter Form -->
<form method="get" class="filters-form">
    <input type="text" name="search" placeholder="Search games..." value="{{ current_search }}">
    <select name="genre">
        <option value="">All Genres</option>
        {% for g in genre_list %}
            <option value="{{ g }}" {% if current_genre == g %}selected{% endif %}>{{ g }}</option>
        {% endfor %}
    </select>
    <select name="platform">
        <option value="">All Platforms</option>
        {% for p in platform_list %}
            <option value="{{ p }}" {% if current_platform == p %}selected{% endif %}>{{ p }}</option>
        {% endfor %}
    </select>
    <select name="sort">
        {% for key, label in valid_sort_fields.items %}
            <option value="{{ key }}" {% if current_sort == key %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
    </select>
    <button type="submit">Apply</button>
</form>

<hr>

<!-- Game List -->
<ul class="games-list">
    {% for game in all_games %}
        <li>
            {% if game.cover_image %}
                <img src="{{ game.cover_image.url }}" alt="{{ game.name }}" style="max-width: 100px; max-height: 100px; margin-right: 10px;">
            {% else %}
                <span style="display: inline-block; width: 100px; text-align: center;">No Image</span>
            {% endif %}
            <a href="{% url 'game_detail' game.id %}">{{ game.name }}</a>
            - ‚≠ê {{ game.rating_average|default:"N/A" }}
            - {{ game.platform }}
            - Released: {{ game.release_date }}
        </li>
    {% empty %}
        <li>No games found.</li>
    {% endfor %}
</ul>


<!-- Pagination -->
<div class="pagination">
    {% if all_games.has_previous %}
        <a href="?page={{ all_games.previous_page_number }}{% if query_string %}&{{ query_string }}{% endif %}">Previous</a>
    {% endif %}

    <span>Page {{ all_games.number|default:"N/A" }} of {{ all_games.paginator.num_pages|default:"N/A" }}</span>

    {% if all_games.has_next %}
        <a href="?page={{ all_games.next_page_number }}{% if query_string %}&{{ query_string }}{% endif %}">Next</a>
    {% endif %}
</div>

{% endblock content %}